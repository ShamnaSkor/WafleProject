/*
The MIT License (MIT)
Copyright (c) 2013 Shamna Skor
Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:
The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
@license
*/
var Wafle;!function(t){function i(t,i){return Math.round(t*Math.pow(10,-1*i))*Math.pow(10,i)}function e(){return 2.718281828459}function a(t){return Math.pow(e(),-.140274*Math.pow(t,2))}function s(t,i){i.name=t.n,i.description=t.d,i.cpuUsage=t.cpu||0,i.powergridUsage=t.pg||0,i.metaLevel=t.mta,i.marketGroup=t.mg,i.parentMarketGroup=t.pmg,i.volume=t.v,i.techLevel=t.tl,i.race=t.r}function r(t,i){i.optimalRange=t.opt,i.accuracyFalloff=t.acc,i.rateOfFire=t.rof,i.trackingSpeed=t.trk,i.damageMultiplier=t.dmg,i.slotUsed=1,i.launcherGroup=t.lg,i.chargeSize=t.cs,i.cpuUsageActual=function(t){return k.standardWeapon(t,i.cpuUsage)},i.powergridUsageActual=function(t){return E.standardWeapon(t,i.powergridUsage)},i.emAlphaDamageActual=function(t,e){return e.emBaseDamage*i.damageMultiplier*t.emDamageMultiplier(i,e)},i.explosiveAlphaDamageActual=function(t,e){return e.explosiveBaseDamage*i.damageMultiplier*t.explosiveDamageMultiplier(i,e)},i.kineticAlphaDamageActual=function(t,e){return e.kineticBaseDamage*i.damageMultiplier*t.kineticDamageMultiplier(i,e)},i.thermalAlphaDamageActual=function(t,e){return e.thermalBaseDamage*i.damageMultiplier*t.thermalDamageMultiplier(i,e)}}function n(t,i){i.rateOfFire=t.rof,i.slotUsed=1,i.cpuUsageActual=function(t){return k.standardWeapon(t,i.cpuUsage)},i.powergridUsageActual=function(t){return E.standardWeapon(t,i.powergridUsage)},i.launcherGroup=t.lg,i.emAlphaDamageActual=function(t,e){return e.emBaseDamage*t.emDamageMultiplier(i,e)},i.explosiveAlphaDamageActual=function(t,e){return e.explosiveBaseDamage*t.explosiveDamageMultiplier(i,e)},i.kineticAlphaDamageActual=function(t,e){return e.kineticBaseDamage*t.kineticDamageMultiplier(i,e)},i.thermalAlphaDamageActual=function(t,e){return e.thermalBaseDamage*t.thermalDamageMultiplier(i,e)}}function o(t,i){i.optimalRange=t.opt,i.accuracyFalloff=t.acc,i.slotUsed=2,t.srb&&(i.signatureRadiusBonusOfTarget=t.srb),t.ad&&(i.activationDuration=t.ad),i.cpuUsageActual=function(t){return k.standardModule(t,this.cpuUsage)},i.powergridUsageActual=function(t){return E.standardModule(t,this.powergridUsage)}}function l(t,i){i.speedFactor=t.spd,t.srb&&(i.signatureRadiusBonus=t.srb),i.slotUsed=2,i.cpuUsageActual=function(t){return k.standardModule(t,this.cpuUsage)},i.powergridUsageActual=function(t){return E.standardModule(t,this.powergridUsage)}}function u(t,i){i.slotUsed=2,i.shieldHPBonusAdd=t.shp,i.signatureRadiusBonus=t.sra,i.cpuUsageActual=function(t){return k.standardModule(t,this.cpuUsage)},i.powergridUsageActual=function(t){return E.shieldUpgradeModule(t,this.powergridUsage)}}function p(t,i){i.droneBandwidthUsed=t.dbu,i.optimalRange=t.opt,i.accuracyFalloff=t.acc,i.rateOfFire=t.rof,i.trackingSpeed=t.trk,i.damageMultiplier=t.dmg,i.emBaseDamage=t.emd,i.explosiveBaseDamage=t.exd,i.kineticBaseDamage=t.kid,i.thermalBaseDamage=t.thd,i.emAlphaDamageActual=function(t){return i.emBaseDamage*i.damageMultiplier*t.emDamageMultiplier(i,null)},i.explosiveAlphaDamageActual=function(t){return i.explosiveBaseDamage*i.damageMultiplier*t.explosiveDamageMultiplier(i,null)},i.kineticAlphaDamageActual=function(t){return i.kineticBaseDamage*i.damageMultiplier*t.kineticDamageMultiplier(i,null)},i.thermalAlphaDamageActual=function(t){return i.thermalBaseDamage*i.damageMultiplier*t.thermalDamageMultiplier(i,null)}}function h(t,i){i.slotUsed=3,t.rofm&&(i.rateOfFireMultiplier=t.rofm),t.dmg&&(i.damageMultiplier=t.dmg),t.midm&&(i.missileDamageMultiplier=t.midm),i.cpuUsageActual=function(t){return k.standardModule(t,this.cpuUsage)},i.powergridUsageActual=function(t){return E.standardModule(t,this.powergridUsage)}}function g(t,i){t.ahp&&(i.armorHPBonusAdd=t.ahp),t.ahpbp&&(i.armorHPBonusPercent=function(i){return t.ahpbp}),(t.emdrb||t.exdrb||t.kidrb||t.thdrb)&&(i.armorResists=new H(new B((100+(t.emdrb||0))/100),new B((100+(t.exdrb||0))/100),new B((100+(t.kidrb||0))/100),new B((100+(t.thdrb||0))/100),!0)),i.slotUsed=3,i.cpuUsageActual=function(t){return k.standardModule(t,this.cpuUsage)},i.powergridUsageActual=function(t){return E.standardModule(t,this.powergridUsage)}}function c(t,i){i.slotUsed=3,i.powerGridIncrease=t.pginc,i.cpuUsageActual=function(t){return k.standardModule(t,this.cpuUsage)},i.powergridUsageActual=function(t){return 0}}function d(t,i){i.hullResists=new H(t.hemr,t.hexr,t.hkir,t.hthr,!1),i.armorResists=new H(t.aemr,t.aexr,t.akir,t.athr,!1),i.shieldResists=new H(t.semr,t.sexr,t.skir,t.sthr,!1),i.slotUsed=3,i.cpuUsageActual=function(t){return k.standardModule(t,this.cpuUsage)},i.powergridUsageActual=function(t){return E.standardModule(t,this.powergridUsage)}}function m(t,i){i.emBaseDamage=t.emd,i.explosiveBaseDamage=t.exd,i.kineticBaseDamage=t.kid,i.thermalBaseDamage=t.thd,i.weaponsRangeModifier=t.wrm,i.chargeSize=t.cs,i.launcherGroup=t.lg,i.trackingSpeedModifier=t.tsm}function f(t,i){i.shipHullHPMultiplier=t.sshpm,i.agilityMultiplier=t.agim,i.baseVelocityMultiplier=t.velm,i.slotUsed=3,i.cpuUsageActual=function(t){return k.standardModule(t,i.cpuUsage)},i.powergridUsageActual=function(t){return E.standardModule(t,i.powergridUsage)}}function D(t,i){i.slotUsed=1,i.optimalRange=t.opt,i.capacitorNeed=t.capn,i.activationDuration=t.ad,i.powerTransferAmount=t.pta,i.energyDestabilizationAmount=t.eda,i.cpuUsageActual=function(t){return k.standardModule(t,i.cpuUsage)},i.powergridUsageActual=function(t){return E.standardModule(t,i.powergridUsage)}}function S(i,e){e.cpuUsageActual=function(){return 0},e.powergridUsageActual=function(){return 0},e.slotUsed=4,e.drawback=i.drwbk;var a=new U(e.typeId,e.groupId);773==e.groupId?(e.armorResists=new H(.01*(100+i.emdrb)||1,.01*(100+i.exdrb)||1,.01*(100+i.kidrb)||1,.01*(100+i.thdrb)||1),t.Data.DrawbackIsArmorRepairPowergridPenalty(a)||t.Data.DrawbackIsMaxVelocityPenalty(a)&&(e.baseVelocityMultiplier=e.drawback,e.actualVelocityMultiplier=function(t){var i=e.drawback;return t.pilot&&(i*=1-.1*t.pilot.skills.ArmorRigging),i}),i.ahpbp&&(e.armorHPBonusPercent=function(t){return i.ahpbp})):774==e.groupId?e.shieldResists=new H(.01*(100+i.emdrb)||1,.01*(100+i.exdrb)||1,.01*(100+i.kidrb)||1,.01*(100+i.thdrb)||1):782==e.groupId&&(i.agim&&(e.agilityMultiplier=i.agim),i.velm&&(e.baseVelocityMultiplier=i.velm),e.armorHPBonusPercent=function(t){return e.drawback*(1-.1*t.pilot.skills.AstronauticsRigging)})}function y(i){for(var e=Object.getOwnPropertyNames(t.Data.Types).length,a=0;e>a;a++)for(var s=Object.getOwnPropertyNames(t.Data.Types)[a],r=Object.getOwnPropertyNames(t.Data.Types[s]).length,n=0;r>n;n++){var o=Object.getOwnPropertyNames(t.Data.Types[s])[n];if(t.Data.Types[s][o].n===i)return new U(parseInt(o),parseInt(s))}return null}t.Version="0.1.0-alpha.5",function(t){t[t.Unknown=0]="Unknown",t[t.Caldari=1]="Caldari",t[t.Minmatar=2]="Minmatar",t[t.Amarr=4]="Amarr",t[t.Gallente=8]="Gallente",t[t.ORE=9]="ORE"}(t.RaceType||(t.RaceType={}));var b=t.RaceType;!function(t){t[t.Unknown=0]="Unknown",t[t.High=1]="High",t[t.Mid=2]="Mid",t[t.Low=3]="Low",t[t.Rig=4]="Rig"}(t.FittingSlotType||(t.FittingSlotType={}));var A=t.FittingSlotType;!function(t){t[t.Unknown=0]="Unknown",t[t.Small=1]="Small",t[t.Medium=2]="Medium",t[t.Large=3]="Large",t[t.Capital=4]="Capital"}(t.RigSize||(t.RigSize={}));var M=t.RigSize;!function(t){t[t.Unknown=-1]="Unknown",t[t.Frigate=25]="Frigate",t[t.ShieldExtender=38]="ShieldExtender",t[t.Propulsion=46]="Propulsion",t[t.WarpScrambler=52]="WarpScrambler",t[t.EnergyWeapon=53]="EnergyWeapon",t[t.ProjectileWeapon=55]="ProjectileWeapon",t[t.Gyrostabilizer=59]="Gyrostabilizer",t[t.DamageControl=60]="DamageControl",t[t.ArmorRepairUnit=62]="ArmorRepairUnit",t[t.StasisWeb=65]="StasisWeb",t[t.EnergyVampire=68]="EnergyVampire",t[t.EnergyDestabilizer=71]="EnergyDestabilizer",t[t.HybridWeapon=74]="HybridWeapon",t[t.ShieldHardener=77]="ShieldHardener",t[t.ProjectileAmmo=83]="ProjectileAmmo",t[t.HybridCharge=85]="HybridCharge",t[t.FrequencyCrystal=86]="FrequencyCrystal",t[t.ArmorCoating=98]="ArmorCoating",t[t.CombatDrone=100]="CombatDrone",t[t.HeatSink=205]="HeatSink",t[t.MagneticFieldStabilizer=302]="MagneticFieldStabilizer",t[t.ArmorRepairProjector=325]="ArmorRepairProjector",t[t.ArmorPlatingEnergized=326]="ArmorPlatingEnergized",t[t.ArmorPlate=329]="ArmorPlate",t[t.AuxiliaryPowerCore=339]="AuxiliaryPowerCore",t[t.BallisticControlSystem=367]="BallisticControlSystem",t[t.AdvancedAutocannonAmmo=372]="AdvancedAutocannonAmmo",t[t.AdvancedRailgunCharge=373]="AdvancedRailgunCharge",t[t.AdvancedBeamLaserCrystal=374]="AdvancedBeamLaserCrystal",t[t.AdvancedPulseLaserCrystal=375]="AdvancedPulseLaserCrystal",t[t.AdvancedArtilleryAmmo=376]="AdvancedArtilleryAmmo",t[t.AdvancedBlasterCharge=377]="AdvancedBlasterCharge",t[t.TargetPainter=379]="TargetPainter",t[t.LightMissile=384]="LightMissile",t[t.HeavyMissile=385]="HeavyMissile",t[t.Rocket=387]="Rocket",t[t.FoFHeavyMissile=395]="FoFHeavyMissile",t[t.RocketLauncher=507]="RocketLauncher",t[t.LightMissileLauncher=509]="LightMissileLauncher",t[t.HeavyMissileLauncher=510]="HeavyMissileLauncher",t[t.RapidLightMissileLauncher=511]="RapidLightMissileLauncher",t[t.AdvancedRocket=648]="AdvancedRocket",t[t.AdvancedLightMissile=653]="AdvancedLightMissile",t[t.AdvancedHeavyAssaultMissile=654]="AdvancedHeavyAssaultMissile",t[t.AdvancedHeavyMissile=655]="AdvancedHeavyMissile",t[t.Nanofiber=763]="Nanofiber",t[t.HeavyAssaultMissileLauncher=771]="HeavyAssaultMissileLauncher",t[t.HeavyAssaultMissile=772]="HeavyAssaultMissile",t[t.ArmorRig=773]="ArmorRig",t[t.ShieldRig=774]="ShieldRig",t[t.NavigationRig=782]="NavigationRig"}(t.InventoryGroups||(t.InventoryGroups={}));var v=t.InventoryGroups;t.Round=i,t.e=e,t.dimEffRatio=a;var R=function(){function i(t,i){this.slotType=t,this.ship=i,this.loadedCharge=null,this.baseShipEquipmentData=null}return i.prototype.cpuUsage=function(){return this.baseShipEquipmentData?this.baseShipEquipmentData.cpuUsageActual(this.ship):0},i.prototype.powergridUsage=function(){return this.baseShipEquipmentData?this.baseShipEquipmentData.powergridUsageActual(this.ship):0},i.prototype.SetModule=function(i,e){var a;if(a=e?e:t.Data.TypeToGroupIDMapping[i.toString()],!a)throw"typeId "+i.toString()+" is not a member of a known inventory group.";if(this.baseShipEquipmentData=new C(a,i),this.baseShipEquipmentData&&this.baseShipEquipmentData.slotUsed!==this.slotType){var s="Module "+this.baseShipEquipmentData.name+" only fits in a "+A[this.baseShipEquipmentData.slotUsed]+" slot.";throw this.baseShipEquipmentData=null,s}},i.prototype.LoadedCharge=function(){return this.loadedCharge},i.prototype.LoadCharge=function(i){if(!t.Data.IsLoadableCharge(i))throw"Type "+i.typeId+" in group "+i.groupId+" is not a loadable charge.";var e=new C(i);if(e.launcherGroup!==this.baseShipEquipmentData.groupId)throw"Type "+i.typeId+" is not compatible with a launcher of type "+this.baseShipEquipmentData.name+".";this.loadedCharge=e},i.prototype.totalAlphaDamage=function(){return this.baseShipEquipmentData?this.baseShipEquipmentData.totalAlphaDamageActual(this.ship,this.loadedCharge):0},i}();t.FittingSlot=R;var w=function(){function e(t){this.hullName=t,this.pilot=null,this.fittingSlots=[],this.droneBay=[],this.cargoHold=[],this.baseShipData=new q(t);for(var i=0;i<this.baseShipData.highSlotCount;i++)this.fittingSlots.push(new R(1,this));for(var e=0;e<this.baseShipData.midSlotCount;e++)this.fittingSlots.push(new R(2,this));for(var a=0;a<this.baseShipData.lowSlotCount;a++)this.fittingSlots.push(new R(3,this));for(var s=0;s<this.baseShipData.rigSlotCount;s++)this.fittingSlots.push(new R(4,this))}return e.prototype.DroneBandwidthUsed=function(){for(var t=0,i=0;i<this.droneBay.length;i++)this.droneBay[i].droneBandwidthUsed&&this.droneBay[i].isActive&&(t+=this.droneBay[i].droneBandwidthUsed);return t},e.prototype.DroneBandwidthRemaining=function(){return this.baseShipData.droneBandwidth-this.DroneBandwidthUsed()},e.prototype.DroneCapacityRemaining=function(){return this.baseShipData.droneBayCapacity-this.DroneCapacityUsed()},e.prototype.DroneCapacityUsed=function(){for(var t=0,i=0;i<this.droneBay.length;i++)this.droneBay[i].volume&&(t+=this.droneBay[i].volume);return t},e.prototype.LoadDrone=function(t){var i=new C(t);if(i.volume>this.DroneCapacityRemaining())throw"This drone will not fit in the drone bay.";this.droneBay.push(i)},e.prototype.LoadDrones=function(t,i){if(0>i)throw"Parameter 'count' must be a positive number.";for(var e=0;i>e;e++)this.LoadDrone(t)},e.prototype.totalDroneAlphaDamage=function(){return this.emDroneAlphaDamage()+this.explosiveDroneAlphaDamage()+this.kineticDroneAlphaDamage()+this.thermalDroneAlphaDamage()},e.prototype.emDroneAlphaDamage=function(){for(var t=0,i=0;i<this.droneBay.length;i++)this.droneBay[i].droneBandwidthUsed&&this.droneBay[i].isActive&&(t+=this.droneBay[i].emAlphaDamageActual(this,null));return t},e.prototype.explosiveDroneAlphaDamage=function(){for(var t=0,i=0;i<this.droneBay.length;i++)this.droneBay[i].droneBandwidthUsed&&this.droneBay[i].isActive&&(t+=this.droneBay[i].explosiveAlphaDamageActual(this,null));return t},e.prototype.kineticDroneAlphaDamage=function(){for(var t=0,i=0;i<this.droneBay.length;i++)this.droneBay[i].droneBandwidthUsed&&this.droneBay[i].isActive&&(t+=this.droneBay[i].kineticAlphaDamageActual(this,null));return t},e.prototype.thermalDroneAlphaDamage=function(){for(var t=0,i=0;i<this.droneBay.length;i++)this.droneBay[i].droneBandwidthUsed&&this.droneBay[i].isActive&&(t+=this.droneBay[i].thermalAlphaDamageActual(this,null));return t},e.prototype.SetPilot=function(t){this.pilot=t},e.prototype.isPiloted=function(){return!!this.pilot},e.prototype.powergrid=function(){for(var t=this.baseShipData.powergridOutput,i=0;i<=this.baseShipData.slotCount();i++)this.fittingSlots[i]&&this.fittingSlots[i].baseShipEquipmentData&&(t+=this.fittingSlots[i].baseShipEquipmentData.powerGridIncrease);return this.pilot&&(t*=this.pilot.skills.powergridMultiplier()),t},e.prototype.powergridString=function(){return this.powergrid().toFixed(2)},e.prototype.cpu=function(){return this.pilot?i(this.baseShipData.cpuOutput*this.pilot.skills.cpuMultiplier(),-2):this.baseShipData.cpuOutput},e.prototype.remainingCpu=function(){for(var t=this.cpu(),e=0;e<this.fittingSlots.length;e++)t-=this.fittingSlots[e].cpuUsage();return i(t,-2)},e.prototype.remainingPowergrid=function(){for(var t=this.powergrid(),e=0;e<this.fittingSlots.length;e++)t-=this.fittingSlots[e].powergridUsage();return i(t,-2)},e.prototype.cpuString=function(){return this.cpu().toFixed(2)},e.prototype.shieldHP=function(){for(var t=this.baseShipData.shieldHP,e=0;e<=this.baseShipData.slotCount();e++)this.fittingSlots[e]&&this.fittingSlots[e].baseShipEquipmentData&&(t+=this.fittingSlots[e].baseShipEquipmentData.shieldHPBonusAdd);this.pilot&&(t*=this.pilot.skills.shieldHPMultiplier());for(var e=0;e<=this.baseShipData.slotCount();e++)this.fittingSlots[e]&&this.fittingSlots[e].baseShipEquipmentData&&this.fittingSlots[e].baseShipEquipmentData.shieldHPBonusPercent&&(t*=1+.01*this.fittingSlots[e].baseShipEquipmentData.shieldHPBonusPercent(this));return i(t,0)},e.prototype.armorHP=function(){for(var t=this.baseShipData.armorHP,e=0;e<=this.baseShipData.slotCount();e++)this.fittingSlots[e]&&this.fittingSlots[e].baseShipEquipmentData&&(t+=this.fittingSlots[e].baseShipEquipmentData.armorHPBonusAdd);this.pilot&&(t*=this.pilot.skills.armorHPMultiplier());for(var e=0;e<=this.baseShipData.slotCount();e++)this.fittingSlots[e]&&this.fittingSlots[e].baseShipEquipmentData&&this.fittingSlots[e].baseShipEquipmentData.armorHPBonusPercent&&(t*=1+.01*this.fittingSlots[e].baseShipEquipmentData.armorHPBonusPercent(this));return i(t,0)},e.prototype.structureHP=function(){return this.pilot?i(this.baseShipData.structureHP*this.pilot.skills.structureHPMultiplier(),0):this.baseShipData.structureHP},e.prototype.totalHP=function(){return this.structureHP()+this.armorHP()+this.shieldHP()},e.prototype.ShieldEMDamageReduction=function(){for(var t=1-this.baseShipData.shieldResists.EM.baseDamageReductionPercentage(),i=[],e=0;e<=this.baseShipData.slotCount();e++)this.fittingSlots[e]&&this.fittingSlots[e].baseShipEquipmentData&&this.fittingSlots[e].baseShipEquipmentData.shieldResists&&(this.fittingSlots[e].baseShipEquipmentData.shieldResists.HasDiminishingReturns===!0?i.push(1-this.fittingSlots[e].baseShipEquipmentData.shieldResists.EM.baseDamageReductionPercentage()):t*=1-this.fittingSlots[e].baseShipEquipmentData.shieldResists.EM.baseDamageReductionPercentage());return 1-this.multiplyPercentages(t,i,!0)},e.prototype.ShieldExplosiveDamageReduction=function(){for(var t=1-this.baseShipData.shieldResists.Explosive.baseDamageReductionPercentage(),i=[],e=0;e<=this.baseShipData.slotCount();e++)this.fittingSlots[e]&&this.fittingSlots[e].baseShipEquipmentData&&this.fittingSlots[e].baseShipEquipmentData.shieldResists&&(this.fittingSlots[e].baseShipEquipmentData.shieldResists.HasDiminishingReturns===!0?i.push(1-this.fittingSlots[e].baseShipEquipmentData.shieldResists.Explosive.baseDamageReductionPercentage()):t*=1-this.fittingSlots[e].baseShipEquipmentData.shieldResists.Explosive.baseDamageReductionPercentage());return 1-this.multiplyPercentages(t,i,!0)},e.prototype.ShieldKineticDamageReduction=function(){for(var t=1-this.baseShipData.shieldResists.Kinetic.baseDamageReductionPercentage(),i=[],e=0;e<=this.baseShipData.slotCount();e++)this.fittingSlots[e]&&this.fittingSlots[e].baseShipEquipmentData&&this.fittingSlots[e].baseShipEquipmentData.shieldResists&&(this.fittingSlots[e].baseShipEquipmentData.shieldResists.HasDiminishingReturns===!0?i.push(1-this.fittingSlots[e].baseShipEquipmentData.shieldResists.Kinetic.baseDamageReductionPercentage()):t*=1-this.fittingSlots[e].baseShipEquipmentData.shieldResists.Kinetic.baseDamageReductionPercentage());return 1-this.multiplyPercentages(t,i,!0)},e.prototype.ShieldThermalDamageReduction=function(){for(var t=1-this.baseShipData.shieldResists.Thermal.baseDamageReductionPercentage(),i=[],e=0;e<=this.baseShipData.slotCount();e++)this.fittingSlots[e]&&this.fittingSlots[e].baseShipEquipmentData&&this.fittingSlots[e].baseShipEquipmentData.shieldResists&&(this.fittingSlots[e].baseShipEquipmentData.shieldResists.HasDiminishingReturns===!0?i.push(1-this.fittingSlots[e].baseShipEquipmentData.shieldResists.Thermal.baseDamageReductionPercentage()):t*=1-this.fittingSlots[e].baseShipEquipmentData.shieldResists.Thermal.baseDamageReductionPercentage());return 1-this.multiplyPercentages(t,i,!0)},e.prototype.ArmorEMDamageReduction=function(){return this.ArmorSpecificDamageReduction("EM")},e.prototype.ArmorExplosiveDamageReduction=function(){return this.ArmorSpecificDamageReduction("Explosive")},e.prototype.ArmorKineticDamageReduction=function(){return this.ArmorSpecificDamageReduction("Kinetic")},e.prototype.ArmorThermalDamageReduction=function(){return this.ArmorSpecificDamageReduction("Thermal")},e.prototype.ArmorSpecificDamageReduction=function(i){for(var e=1-this.baseShipData.armorResists[i].baseDamageReductionPercentage(),a=[],s=0;s<=this.baseShipData.slotCount();s++)if(this.fittingSlots[s]&&this.fittingSlots[s].baseShipEquipmentData&&this.fittingSlots[s].baseShipEquipmentData.armorResists)if(this.fittingSlots[s].baseShipEquipmentData.armorResists.HasDiminishingReturns===!0){var r=1-this.fittingSlots[s].baseShipEquipmentData.armorResists[i].baseDamageReductionPercentage();if(t.Data.AffectedByArmorCompensationSkills(this.fittingSlots[s].baseShipEquipmentData.typeInfo())){var n=i.replace("Thermal","Thermic")+"ArmorCompensation";r=1-(1-r)*(1+.05*this.pilot.skills[n])}1!==r&&a.push(r)}else e*=1-this.fittingSlots[s].baseShipEquipmentData.armorResists[i].baseDamageReductionPercentage();return 1-this.multiplyPercentages(e,a,!0)},e.prototype.HullEMDamageReduction=function(){for(var t=1-this.baseShipData.hullResists.EM.baseDamageReductionPercentage(),i=[],e=0;e<=this.baseShipData.slotCount();e++)this.fittingSlots[e]&&this.fittingSlots[e].baseShipEquipmentData&&this.fittingSlots[e].baseShipEquipmentData.hullResists&&(this.fittingSlots[e].baseShipEquipmentData.hullResists.HasDiminishingReturns===!0?i.push(1-this.fittingSlots[e].baseShipEquipmentData.hullResists.EM.baseDamageReductionPercentage()):t*=1-this.fittingSlots[e].baseShipEquipmentData.hullResists.EM.baseDamageReductionPercentage());return 1-this.multiplyPercentages(t,i,!0)},e.prototype.HullExplosiveDamageReduction=function(){for(var t=1-this.baseShipData.hullResists.Explosive.baseDamageReductionPercentage(),i=[],e=0;e<=this.baseShipData.slotCount();e++)this.fittingSlots[e]&&this.fittingSlots[e].baseShipEquipmentData&&this.fittingSlots[e].baseShipEquipmentData.hullResists&&(this.fittingSlots[e].baseShipEquipmentData.hullResists.HasDiminishingReturns===!0?i.push(1-this.fittingSlots[e].baseShipEquipmentData.hullResists.Explosive.baseDamageReductionPercentage()):t*=1-this.fittingSlots[e].baseShipEquipmentData.hullResists.Explosive.baseDamageReductionPercentage());return 1-this.multiplyPercentages(t,i,!0)},e.prototype.HullKineticDamageReduction=function(){for(var t=1-this.baseShipData.hullResists.Kinetic.baseDamageReductionPercentage(),i=[],e=0;e<=this.baseShipData.slotCount();e++)this.fittingSlots[e]&&this.fittingSlots[e].baseShipEquipmentData&&this.fittingSlots[e].baseShipEquipmentData.hullResists&&(this.fittingSlots[e].baseShipEquipmentData.hullResists.HasDiminishingReturns===!0?i.push(1-this.fittingSlots[e].baseShipEquipmentData.hullResists.Kinetic.baseDamageReductionPercentage()):t*=1-this.fittingSlots[e].baseShipEquipmentData.hullResists.Kinetic.baseDamageReductionPercentage());return 1-this.multiplyPercentages(t,i,!0)},e.prototype.HullThermalDamageReduction=function(){for(var t=1-this.baseShipData.hullResists.Thermal.baseDamageReductionPercentage(),i=[],e=0;e<=this.baseShipData.slotCount();e++)this.fittingSlots[e]&&this.fittingSlots[e].baseShipEquipmentData&&this.fittingSlots[e].baseShipEquipmentData.hullResists&&(this.fittingSlots[e].baseShipEquipmentData.hullResists.HasDiminishingReturns===!0?i.push(1-this.fittingSlots[e].baseShipEquipmentData.hullResists.Thermal.baseDamageReductionPercentage()):t*=1-this.fittingSlots[e].baseShipEquipmentData.hullResists.Thermal.baseDamageReductionPercentage());return 1-this.multiplyPercentages(t,i,!0)},e.prototype.MaxVelocity=function(){var t=this.baseShipData.maxVelocity;this.pilot&&(t*=this.pilot.skills.velocityMultiplier());for(var e=[],a=0;a<=this.baseShipData.slotCount();a++)this.fittingSlots[a]&&this.fittingSlots[a].baseShipEquipmentData&&this.fittingSlots[a].baseShipEquipmentData.baseVelocityMultiplier&&(this.fittingSlots[a].baseShipEquipmentData.actualVelocityMultiplier?e.push(1+this.fittingSlots[a].baseShipEquipmentData.actualVelocityMultiplier(this)/100):e.push(1+this.fittingSlots[a].baseShipEquipmentData.baseVelocityMultiplier/100));return i(this.multiplyPercentages(t,e),-2)},e.prototype.multiplyPercentages=function(t,i,e){"undefined"==typeof e&&(e=!1),i=e?this.SortArrayByAscendingAbsoluteValue(i):this.SortArrayByDescendingAbsoluteValue(i);for(var s=0,r=0,n=0;n<i.length;n++)i[n]>1?(t*=1+(i[n]-1)*a(s),s+=1):i[n]<1&&(t*=1-(1-i[n])*a(r),r+=1);return t},e.prototype.SortArrayByAscendingAbsoluteValue=function(t){return t.sort(function(t,i){return Math.abs(t)-Math.abs(i)})},e.prototype.SortArrayByDescendingAbsoluteValue=function(t){return t.sort(function(t,i){return Math.abs(i)-Math.abs(t)})},e.prototype.emDamageMultiplier=function(i,e){var a=t.Data.ShipOmniDamageMultiplier(this,i,e);return this.pilot&&(a*=this.pilot.OmniDamageMultiplier(i)),a},e.prototype.explosiveDamageMultiplier=function(i,e){var a=t.Data.ShipOmniDamageMultiplier(this,i,e);return this.pilot&&(a*=this.pilot.OmniDamageMultiplier(i)),a},e.prototype.kineticDamageMultiplier=function(i,e){var a=t.Data.ShipOmniDamageMultiplier(this,i,e);return this.pilot&&(a*=this.pilot.OmniDamageMultiplier(i)),a},e.prototype.thermalDamageMultiplier=function(i,e){var a=t.Data.ShipOmniDamageMultiplier(this,i,e);return this.pilot&&(a*=this.pilot.OmniDamageMultiplier(i)),a},e.prototype.totalAlphaDamageActual=function(){for(var t=0,i=0;i<this.fittingSlots.length;i++)t+=this.fittingSlots[i].baseShipEquipmentData.totalAlphaDamageActual(this,this.fittingSlots[i].LoadedCharge());return t},e}();t.Ship=w;var I=function(){function i(t){this.name=t,this.skills=new P}return i.prototype.OmniDamageMultiplier=function(i){var e=1;if(55===i.groupId)switch(e*=this.skills.surgicalStrikeDamageMultiplier(),i.chargeSize){case 1:e*=this.skills.smallProjectileTurretDamageMultiplier()}else if(74===i.groupId)switch(e*=this.skills.surgicalStrikeDamageMultiplier(),i.chargeSize){case 1:e*=this.skills.smallHybridTurretDamageMultiplier(),2==i.techLevel&&(t.Data.IsBlaster(i)?e*=this.skills.smallT2BlasterDamageMultiplier():t.Data.IsRailgun(i)&&(e*=this.skills.smallT2RailgunDamageMultiplier()))}else 507===i.groupId?e*=this.skills.rocketsDamageMultiplier()*this.skills.warheadDamageMultiplier():509===i.groupId&&(e*=this.skills.lightMissilesDamageMultiplier()*this.skills.warheadDamageMultiplier());return e},i}();t.Pilot=I;var P=function(){function t(){this.PowerGridManagement=0,this.CPUManagement=0,this.HullUpgrades=0,this.Mechanics=0,this.ShieldManagement=0,this.ShieldUpgrades=0,this.WeaponUpgrades=0,this.AdvancedWeaponUpgrades=0,this.Navigation=0,this.ArmorRigging=0,this.AstronauticsRigging=0,this.EMArmorCompensation=0,this.ExplosiveArmorCompensation=0,this.KineticArmorCompensation=0,this.ThermicArmorCompensation=0,this.GallenteFrigate=0,this.MinmatarFrigate=0,this.CaldariFrigate=0,this.AmarrFrigate=0,this.GallenteCruiser=0,this.MinmatarCruiser=0,this.CaldariCruiser=0,this.AmarrCruiser=0,this.SmallProjectileTurret=0,this.SurgicalStrike=0,this.Rockets=0,this.LightMissiles=0,this.WarheadUpgrades=0,this.SmallHybridTurret=0,this.SmallRailgunSpecialization=0,this.SmallBlasterSpecialization=0,this.Drones=0,this.DroneInterfacing=0,this.CombatDroneOperation=0,this.GallenteDroneSpecialization=0,this.MinmatarDroneSpecialization=0,this.CaldariDroneSpecialization=0,this.AmarrDroneSpecialization=0}return t.prototype.SetAllSkills=function(t){this.PowerGridManagement=t,this.CPUManagement=t,this.HullUpgrades=t,this.Mechanics=t,this.ShieldManagement=t,this.ShieldUpgrades=t,this.WeaponUpgrades=t,this.AdvancedWeaponUpgrades=t,this.Navigation=t,this.ArmorRigging=t,this.AstronauticsRigging=t,this.GallenteFrigate=t,this.MinmatarFrigate=t,this.CaldariFrigate=t,this.AmarrFrigate=t,this.GallenteCruiser=t,this.MinmatarCruiser=t,this.CaldariCruiser=t,this.AmarrCruiser=t,this.SmallProjectileTurret=t,this.SmallHybridTurret=t,this.SmallRailgunSpecialization=t,this.SmallBlasterSpecialization=t,this.SurgicalStrike=t,this.Rockets=t,this.LightMissiles=t,this.WarheadUpgrades=t,this.EMArmorCompensation=t,this.ExplosiveArmorCompensation=t,this.KineticArmorCompensation=t,this.ThermicArmorCompensation=t,this.Drones=t,this.DroneInterfacing=t,this.CombatDroneOperation=t,this.GallenteDroneSpecialization=t,this.MinmatarDroneSpecialization=t,this.CaldariDroneSpecialization=t,this.AmarrDroneSpecialization=t},t.prototype.cpuMultiplier=function(){return 1+.05*this.CPUManagement},t.prototype.powergridMultiplier=function(){return 1+.05*this.PowerGridManagement},t.prototype.shieldHPMultiplier=function(){return 1+.05*this.ShieldManagement},t.prototype.armorHPMultiplier=function(){return 1+.05*this.HullUpgrades},t.prototype.structureHPMultiplier=function(){return 1+.05*this.Mechanics},t.prototype.velocityMultiplier=function(){return 1+.05*this.Navigation},t.prototype.smallProjectileTurretDamageMultiplier=function(){return 1+.05*this.SmallProjectileTurret},t.prototype.smallHybridTurretDamageMultiplier=function(){return 1+.05*this.SmallHybridTurret},t.prototype.smallT2BlasterDamageMultiplier=function(){return 1+.02*this.SmallBlasterSpecialization},t.prototype.smallT2RailgunDamageMultiplier=function(){return 1+.02*this.SmallRailgunSpecialization},t.prototype.surgicalStrikeDamageMultiplier=function(){return 1+.03*this.SurgicalStrike},t.prototype.rocketsDamageMultiplier=function(){return 1+.05*this.Rockets},t.prototype.lightMissilesDamageMultiplier=function(){return 1+.05*this.LightMissiles},t.prototype.warheadDamageMultiplier=function(){return 1+.02*this.WarheadUpgrades},t}();t.Skills=P;var k=function(){function t(){}return t.standardWeapon=function(t,i){return t&&t.pilot?i-.05*t.pilot.skills.WeaponUpgrades*i:i},t.standardModule=function(t,i){return i?i:0},t}();t.CpuFormulas=k;var E=function(){function t(){}return t.standardWeapon=function(t,i){return t&&t.pilot?i-.02*t.pilot.skills.AdvancedWeaponUpgrades*i:i},t.standardModule=function(t,i){return i?i:0},t.shieldUpgradeModule=function(t,i){return i?t.pilot?i*(1-.05*t.pilot.skills.ShieldUpgrades):i:0},t}();t.PowergridFormulas=E;var U=function(){function i(t,i){this.typeId=t,void 0===i?this.FindGroupId():this.groupId=i}return i.prototype.FindGroupId=function(){this.groupId=t.Data.TypeToGroupIDMapping[this.typeId.toString()]},i}();t.TypeInfo=U;var C=function(){function i(i,e){if(this.isActive=!1,this.name="",this.techLevel=1,this.description="",this.race=0,this.volume=0,this.accuracyFalloff=0,this.trackingSpeed=0,this.cpuUsage=0,this.rateOfFire=0,this.rateOfFireMultiplier=0,this.powergridUsage=0,this.powerGridIncrease=0,this.optimalRange=0,this.metaLevel=0,this.damageMultiplier=1,this.missileDamageMultiplier=1,this.marketGroup=0,this.parentMarketGroup=0,this.speedFactor=0,this.signatureRadiusBonus=0,this.signatureRadiusBonusOfTarget=0,this.signatureRadiusAdd=0,this.shieldHPBonusAdd=0,this.armorHPBonusAdd=0,this.slotUsed=0,this.hullResists=null,this.armorResists=null,this.shieldResists=null,this.shipHullHPMultiplier=0,this.agilityMultiplier=0,this.baseVelocityMultiplier=0,this.drawback=0,this.activationDuration=0,this.armorHPRepaired=0,this.capacitorNeed=0,this.powerTransferAmount=0,this.energyDestabilizationAmount=0,this.droneBandwidthUsed=0,i.typeId?(i.groupId||i.FindGroupId(),this.typeId=i.typeId,this.groupId=i.groupId):(this.typeId=e,this.groupId=i),!t.Data.Types[this.groupId.toString()])throw"groupId "+this.groupId.toString()+" is not known.";var a=t.Data.Types[this.groupId.toString()][this.typeId.toString()];if(!a)throw"typeId "+this.typeId.toString()+" in groupId "+this.groupId.toString()+" is not known.";switch(s(a,this),this.groupId){case 55:case 74:case 53:r(a,this);break;case 85:case 86:case 373:case 377:case 374:case 375:case 376:case 83:case 387:case 648:case 384:case 653:m(a,this);break;case 507:case 509:case 771:case 510:n(a,this);break;case 65:case 379:o(a,this);break;case 46:l(a,this);break;case 38:u(a,this);break;case 52:o(a,this);break;case 329:case 98:g(a,this);break;case 763:f(a,this);break;case 71:case 68:D(a,this);break;case 773:case 774:case 782:S(a,this);break;case 60:d(a,this);break;case 339:c(a,this);case 367:case 59:case 205:case 302:h(a,this);case 100:p(a,this)}}return i.prototype.totalAlphaDamageActual=function(t,i){var e=0;return this.emAlphaDamageActual&&(e+=this.emAlphaDamageActual(t,i)),this.explosiveAlphaDamageActual&&(e+=this.explosiveAlphaDamageActual(t,i)),this.kineticAlphaDamageActual&&(e+=this.kineticAlphaDamageActual(t,i)),this.thermalAlphaDamageActual&&(e+=this.thermalAlphaDamageActual(t,i)),e},i.prototype.Activate=function(){this.isActive=!0},i.prototype.Deactivate=function(){this.isActive=!1},i.prototype.typeInfo=function(){return new U(this.typeId,this.groupId)},i.prototype.damageMultiplierForModule=function(i){if(0==this.damageMultiplier&&0==this.missileDamageMultiplier)return 1;var e=i.typeInfo();if(t.Data.IsLauncher(e))return this.missileDamageMultiplier;if(55==e.groupId){if(59==this.groupId)return this.damageMultiplier}else if(74==e.groupId){if(302==this.groupId)return this.damageMultiplier}else if(53==e.groupId&&205==this.groupId)return this.damageMultiplier;return 1},i}();t.BaseShipEquipmentData=C;var B=function(){function t(t){this.baseResistRatio=t}return t.prototype.baseDamageReductionPercentage=function(){return 1-this.baseResistRatio},t}();t.Resistance=B;var H=function(){function t(t,i,e,a,s){this.HasDiminishingReturns=!0,this.EM=this.resistLoader(t),this.Explosive=this.resistLoader(i),this.Kinetic=this.resistLoader(e),this.Thermal=this.resistLoader(a),void 0!=s&&(this.HasDiminishingReturns=s)
}return t.prototype.resistLoader=function(t){return t.baseResistRatio?t:new B(t)},t}();t.ResistSet=H;var q=function(){function i(i,e){"undefined"==typeof e&&(e=-1),this.race=0,this.hullResists=null,this.armorResists=null,this.shieldResists=null,this.rigSize=0;var a,s,r;if(null===i)throw"BaseShipData does not accept a null parameter.";if(-1!==e||i.typeId)i.typeId?(a=i.groupId,s=i.typeId):(a=i,s=e);else{r=i;var n=y(r);if(null===n)throw'Could not find ship with name "'+r+'".';a=n.groupId,s=n.typeId}try{var o=t.Data.Types[a.toString()][s.toString()]}catch(l){throw"Ship not found with typeId "+s.toString()+", groupId "+a.toString()+"."}this.typeId=s,this.groupId=a,this.marketGroupId=o.mg,this.parentMarketGroupId=o.pmg,this.metaLevel=o.mta,this.techLevel=o.tl,this.hullName=o.n,this.race=o.r,this.cpuOutput=o.cpuo,this.powergridOutput=o.pgo,this.structureHP=o.shhp,this.armorHP=o.sahp,this.shieldHP=o.sshp,this.hullResists=new H(o.hemr,o.hexr,o.hkir,o.hthr,!1),this.armorResists=new H(o.aemr,o.aexr,o.akir,o.athr,!1),this.shieldResists=new H(o.semr,o.sexr,o.skir,o.sthr,!1),this.lowSlotCount=o.lsc,this.midSlotCount=o.msc,this.highSlotCount=o.hsc,this.rigSlotCount=o.rsc,this.rigSize=o.rgsz,this.calibration=o.calb,this.turretCount=o.tusc,this.launcherCount=o.lasc,this.maxVelocity=o.vel,this.droneBayCapacity=o.dc,this.droneBandwidth=o.db,this.cargoHoldCapacity=o.c}return i.prototype.slotCount=function(){return this.highSlotCount+this.midSlotCount+this.lowSlotCount+this.rigSlotCount},i}();t.BaseShipData=q,"function"!=typeof Object.getOwnPropertyNames&&(Object.getOwnPropertyNames=function(t){var i=[];if("object"==typeof t&&null!==t)for(var e in t)t.hasOwnProperty(e)&&i.push(e);return i}),t.FindTypeByName=y}(Wafle||(Wafle={}));var Wafle;!function(t){!function(i){function e(t){if(void 0===t.groupId&&t.FindGroupId(),773!==t.groupId)return!1;var i=[25896,25898,26294,26296,27064,27066,31045,31047,31049,31051,31053,31063,31065,31067,31069,31071];return i.indexOf(t.typeId)>-1}function a(t){return void 0===t.groupId&&t.FindGroupId(),773!==t.groupId?!1:!e(t)}function s(t){return void 0===t.groupId&&t.FindGroupId(),782===t.groupId}function r(i){var e=t.InventoryGroups;return 98===i.groupId||326===i.groupId}function n(i){var e=t.InventoryGroups;return 55===i.groupId||53===i.groupId||74===i.groupId}function o(t){return 74===t.groupId&&556===t.parentMarketGroup}function l(t){return 74===t.groupId&&555===t.parentMarketGroup}function u(i){var e=t.InventoryGroups;return 507===i.groupId||510===i.groupId||771===i.groupId||509===i.groupId||511===i.groupId}function p(i){var e=t.InventoryGroups;return 376===i.groupId||372===i.groupId||374===i.groupId||377===i.groupId||654===i.groupId||655===i.groupId||653===i.groupId||375===i.groupId||373===i.groupId||648===i.groupId||395===i.groupId||86===i.groupId||772===i.groupId||385===i.groupId||85===i.groupId||384===i.groupId||83===i.groupId||387===i.groupId}function h(t,i,e){var a=1;if(t.pilot&&t.pilot.skills){var s=t.pilot.skills;switch(t.baseShipData.typeId){case 587:55===i.groupId&&1===i.chargeSize&&(a*=1+.05*s.MinmatarFrigate);break;case 602:(507===i.groupId||509===i.groupId)&&(a*=1+.05*s.CaldariFrigate)}if(100===i.groupId&&(a*=1+.2*s.DroneInterfacing,(10==i.volume||5==i.volume)&&(a*=1+.05*s.CombatDroneOperation),2==i.techLevel))switch(i.race){case 2:a*=1+.02*s.MinmatarDroneSpecialization;break;case 8:a*=1+.02*s.GallenteDroneSpecialization;break;case 1:a*=1+.02*s.CaldariDroneSpecialization;break;case 4:a*=1+.02*s.AmarrDroneSpecialization}}for(var r=0;r<t.fittingSlots.length;r++)t.fittingSlots[r].baseShipEquipmentData&&(a*=t.fittingSlots[r].baseShipEquipmentData.damageMultiplierForModule(i));return a}i.DrawbackIsArmorRepairPowergridPenalty=e,i.DrawbackIsMaxVelocityPenalty=a,i.DrawbackIsArmorAmount=s,i.AffectedByArmorCompensationSkills=r,i.IsTurret=n,i.IsBlaster=o,i.IsRailgun=l,i.IsLauncher=u,i.IsLoadableCharge=p,i.ShipOmniDamageMultiplier=h}(t.Data||(t.Data={}));var i=t.Data}(Wafle||(Wafle={}));